<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Management System</title>
    <style>
        :root {
            --bg-primary: #1a1a1a;
            --bg-secondary: #2d2d2d;
            --bg-tertiary: #3d3d3d;
            --text-primary: #ffffff;
            --text-secondary: #b0b0b0;
            --accent: #4CAF50;
            --accent-hover: #45a049;
            --edit: #008CBA;
            --edit-hover: #007B9A;
            --delete: #f44336;
            --delete-hover: #da190b;
            --border: #444444;
            --success: #4caf50;
            --error: #f44336;
            --warning: #ff9800;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: var(--bg-primary);
            color: var(--text-primary);
        }

        .container {
            display: flex;
            gap: 20px;
            margin-top: 20px;
        }

        .form-section {
            flex: 1;
            padding: 25px;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: var(--bg-secondary);
        }

        .list-section {
            flex: 2;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: var(--bg-secondary);
        }

        th, td {
            border: 1px solid var(--border);
            padding: 12px;
            text-align: left;
        }

        th {
            background-color: var(--bg-tertiary);
            font-weight: 600;
            color: var(--text-primary);
        }

        td {
            color: var(--text-secondary);
        }

        .status-in-stock {
            color: var(--success);
            font-weight: 600;
        }

        .status-low-stock {
            color: var(--warning);
            font-weight: 600;
        }

        .status-no-stock {
            color: var(--error);
            font-weight: 600;
        }

        input, button {
            width: 100%;
            padding: 12px;
            margin: 8px 0;
            border: 1px solid var(--border);
            border-radius: 6px;
            box-sizing: border-box;
            font-size: 14px;
            background: var(--bg-primary);
            color: var(--text-primary);
        }

        input:focus {
            outline: none;
            border-color: var(--accent);
        }

        button {
            background-color: var(--accent);
            color: white;
            border: none;
            cursor: pointer;
            font-weight: 600;
            transition: background-color 0.2s;
        }

        button:hover {
            background-color: var(--accent-hover);
        }

        button.delete {
            background-color: var(--delete);
        }

        button.delete:hover {
            background-color: var(--delete-hover);
        }

        button.edit {
            background-color: var(--edit);
        }

        button.edit:hover {
            background-color: var(--edit-hover);
        }

        .message {
            padding: 12px;
            margin: 10px 0;
            border-radius: 6px;
            display: none;
            font-weight: 500;
        }

        .error {
            background-color: rgba(244, 67, 54, 0.1);
            color: var(--error);
            border: 1px solid rgba(244, 67, 54, 0.3);
        }

        .success {
            background-color: rgba(76, 175, 80, 0.1);
            color: var(--success);
            border: 1px solid rgba(76, 175, 80, 0.3);
        }

        .actions {
            display: flex;
            gap: 8px;
        }

        .actions button {
            flex: 1;
            padding: 8px 12px;
            font-size: 13px;
        }

        h1, h2, h3 {
            color: var(--text-primary);
            margin-bottom: 15px;
        }

        h1 {
            border-bottom: 2px solid var(--accent);
            padding-bottom: 10px;
        }

        #totalProducts {
            color: var(--text-secondary);
            font-style: italic;
            margin: 10px 0;
        }

        .clear-btn {
            background-color: #666;
        }

        .clear-btn:hover {
            background-color: #777;
        }

        .info-note {
            color: var(--text-secondary);
            font-size: 12px;
            font-style: italic;
            margin-top: 10px;
        }
    </style>
</head>
<body>
<h1>Product Management System</h1>

<div class="container">
    <!-- Product Form Section -->
    <div class="form-section">
        <h2 id="formTitle">Add New Product</h2>

        <input type="hidden" id="productId">

        <input type="text" id="productName" placeholder="Product Name" required>

        <input type="number" id="productQuantity" placeholder="Quantity" min="0" required>

        <input type="number" id="productPrice" placeholder="Price" step="0.01" min="0" required>

        <div class="info-note">
            ðŸ’¡ Stock status is automatically calculated based on quantity
        </div>

        <div class="actions">
            <button onclick="saveProduct()" id="saveButton">Save Product</button>
            <button onclick="clearForm()" class="clear-btn">Clear Form</button>
        </div>

        <div id="formMessage" class="message"></div>
    </div>

    <!-- Product List Section -->
    <div class="list-section">
        <h2>Product List</h2>

        <div id="totalProducts">Total Products: 0</div>

        <table id="productsTable">
            <thead>
            <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Quantity</th>
                <th>Price</th>
                <th>Stock Status</th>
                <th>Actions</th>
            </tr>
            </thead>
            <tbody>
            <!-- Products will be loaded here -->
            </tbody>
        </table>

        <div id="errorMessage" class="message error">
            Error loading products. Please try again later.
        </div>
    </div>
</div>

<script>
    const API_BASE = 'http://localhost:8080/product';
    let isEditing = false;

    // Load products when page loads
    document.addEventListener('DOMContentLoaded', loadProducts);

    // Load all products
    function loadProducts() {
        fetch(API_BASE)
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network error: ' + response.status);
                }
                return response.json();
            })
            .then(data => {
                displayProducts(data);
                hideError();
            })
            .catch(error => {
                console.error('Error loading products:', error);
                showError('Error loading products: ' + error.message);
            });
    }

    // Display products in table
    function displayProducts(products) {
        const tableBody = document.getElementById('productsTable').getElementsByTagName('tbody')[0];
        tableBody.innerHTML = '';

        products.forEach(product => {
            const statusClass = getStatusClass(product.status);
            const statusText = getStatusText(product.status);

            const row = tableBody.insertRow();
            row.innerHTML = `
                <td>${product.id}</td>
                <td>${product.name}</td>
                <td>${product.quantity}</td>
                <td>$${product.price.toFixed(2)}</td>
                <td class="${statusClass}">${statusText}</td>
                <td class="actions">
                    <button class="edit" onclick="editProduct(${product.id})">Edit</button>
                    <button class="delete" onclick="deleteProduct(${product.id})">Delete</button>
                </td>
            `;
        });

        document.getElementById('totalProducts').textContent = `Total Products: ${products.length}`;
    }

    // Get CSS class for status
    function getStatusClass(status) {
        switch(status) {
            case 'In Stock': return 'status-in-stock';
            case 'Low Stock': return 'status-low-stock';
            case 'No Stock': return 'status-no-stock';
            default: return '';
        }
    }

    // Get display text for status
    function getStatusText(status) {
        // JÃ¡ retorna o texto formatado do backend
        return status || 'Calculating...';
    }

    // Save or Update product
    function saveProduct() {
        const product = {
            name: document.getElementById('productName').value,
            quantity: parseInt(document.getElementById('productQuantity').value),
            price: parseFloat(document.getElementById('productPrice').value)
            // Status removido - serÃ¡ calculado pelo backend
        };

        const productId = document.getElementById('productId').value;
        const url = productId ? `${API_BASE}/${productId}` : API_BASE;
        const method = productId ? 'PUT' : 'POST';

        fetch(url, {
            method: method,
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(product)
        })
        .then(response => {
            if (!response.ok) {
                throw new Error(`Failed to ${productId ? 'update' : 'create'} product`);
            }
            return response.json();
        })
        .then(data => {
            showFormMessage(`Product ${productId ? 'updated' : 'created'} successfully!`, false);
            clearForm();
            loadProducts();
        })
        .catch(error => {
            console.error('Error saving product:', error);
            showFormMessage(`Error ${productId ? 'updating' : 'creating'} product: ${error.message}`, true);
        });
    }

    // Edit product
    function editProduct(id) {
        fetch(`${API_BASE}/${id}`)
            .then(response => {
                if (!response.ok) {
                    throw new Error('Failed to fetch product');
                }
                return response.json();
            })
            .then(product => {
                document.getElementById('productId').value = product.id;
                document.getElementById('productName').value = product.name;
                document.getElementById('productQuantity').value = product.quantity;
                document.getElementById('productPrice').value = product.price;
                // Status nÃ£o Ã© editÃ¡vel - removido do formulÃ¡rio

                document.getElementById('formTitle').textContent = 'Edit Product';
                document.getElementById('saveButton').textContent = 'Update Product';
                isEditing = true;

                showFormMessage('Product loaded for editing', false);
            })
            .catch(error => {
                console.error('Error loading product for edit:', error);
                showFormMessage('Error loading product: ' + error.message, true);
            });
    }

    // Delete product
    function deleteProduct(id) {
        if (!confirm('Are you sure you want to delete this product?')) {
            return;
        }

        fetch(`${API_BASE}/${id}`, {
            method: 'DELETE'
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Failed to delete product');
            }
            showFormMessage('Product deleted successfully!', false);
            loadProducts();
        })
        .catch(error => {
            console.error('Error deleting product:', error);
            showFormMessage('Error deleting product: ' + error.message, true);
        });
    }

    // Clear form
    function clearForm() {
        document.getElementById('productId').value = '';
        document.getElementById('productName').value = '';
        document.getElementById('productQuantity').value = '';
        document.getElementById('productPrice').value = '';

        document.getElementById('formTitle').textContent = 'Add New Product';
        document.getElementById('saveButton').textContent = 'Save Product';
        isEditing = false;

        document.getElementById('formMessage').style.display = 'none';
    }

    // Utility functions
    function showError(message) {
        const errorDiv = document.getElementById('errorMessage');
        errorDiv.textContent = message;
        errorDiv.style.display = 'block';
    }

    function hideError() {
        document.getElementById('errorMessage').style.display = 'none';
    }

    function showFormMessage(message, isError) {
        const messageDiv = document.getElementById('formMessage');
        messageDiv.textContent = message;
        messageDiv.className = isError ? 'message error' : 'message success';
        messageDiv.style.display = 'block';

        setTimeout(() => {
            if (!isEditing) {
                messageDiv.style.display = 'none';
            }
        }, 3000);
    }
</script>
</body>
</html>